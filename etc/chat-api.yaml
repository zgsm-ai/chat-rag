Name: chat-rag
Host: 0.0.0.0
Port: 8888

# Logging configuration
Log:
  LogFilePath: "logs/"

PreciseContextConfig:
  EnableEnvDetailsFilter: true
  # Control which agents in which modes cannot use ModesChange
  DisabledModesChangeAgents:
    strict:
      - "strict"
      - "requirements"
      - "architect"
      - "task"
      - "review"
      - "code"
    vibe:
      - "review"
  
  # Dynamic configuration for task description content
  TaskContentReplaceRule:
    vibeplus: # Group name, used to distinguish different scenarios
      # Specify which agents are effective, the structure here can reuse DisabledModesChangeAgents
      # If not configured, all will be effective, be careful!
      valid_agents:
        vibe:
          - "architect"
          - "code"
          - "ask"
      match_keys:
        "%command-vibeplus-propsal%": |
          **护栏原则**

          - 优先采用最直接、最小化的实现方式，仅在明确需要或被要求时添加复杂性。
          - 保持变更范围是紧密围绕用户预期结果展开的。
          - VibePlus约束或最佳实践，请一定要参考**VibePlus约束和最佳实践**。

          **步骤**
          1. 选择一个唯一的动词引导的`change-id`，并在`vibeplus/changes/<id>/`下构建`proposal.md`、`tasks.md`和`design.md`（需要时）。
          2. 将变更映射到具体能力或需求，将多范围工作分解为具有清晰关系和顺序的不同规格增量。
          3. 当解决方案跨越多个系统、引入新模式时，在`design.md`中写明架构设计考量。
          4. 在`vibeplus/changes/<id>/specs/<capability>/spec.md`（每个能力一个文件夹）中起草规格增量，使用`## ADDED|MODIFIED|REMOVED Requirements`，每个需求至少包含一个`#### Scenario:`，并在关联时交叉引用。
          5. 将`tasks.md`起草为有序的小型可验证工作项目列表，这些项目提供用户可见的进度，包括验证（单元测试即可），并突出依赖项或可并行的工作。

          **VibePlus约束和最佳实践** 

          ~~~markdown
          # VibePlus 指南

          使用 VibePlus 进行规范驱动开发的 AI 编码助手的说明。

          ## 三阶段工作流程

          ### 阶段 1：创建变更
          在以下情况下需要创建提案：
          - 添加功能或特性
          - 进行破坏性变更（API、架构）
          - 更改架构或模式
          - 优化性能（改变行为）
          - 更新安全模式

          触发器（示例）：
          - "帮我创建一个变更提案"
          - "帮我规划一个变更"
          - "帮我创建一个提案"
          - "我想创建一个规范提案"
          - "我想创建一个规范"

          跳过提案的情况：
          - 错误修复（恢复预期行为）
          - 拼写错误、格式、注释
          - 依赖更新（非破坏性）
          - 配置更改
          - 现有行为的测试

          **工作流程**
          1. 选择一个唯一的动词引导的 `change-id`，并在 `vibeplus/changes/<id>/` 下构建 `proposal.md`, `tasks.md`, 可选的 `design.md` 和规范增量。
          2. 使用 `## ADDED|MODIFIED|REMOVED Requirements` 起草规范增量，每个需求至少包含一个 `#### Scenario:`。

          ## 在任何任务之前

          **上下文检查清单：**
          - [ ] 阅读 `specs/[capability]/spec.md` 中的相关规范
          - [ ] 检查 `changes/` 中待处理的变更是否有冲突

          **创建规范之前：**
          - 始终检查功能是否已存在
          - 优先修改现有规范而不是创建重复项
          - 如果请求不明确，在构建脚手架前询问 1-2 个澄清问题

          ## 目录结构

          ```
          vibeplus/
          ├── specs/                  # 当前事实 - 已构建的内容
          │   └── [capability]/       # 单一/专注功能点
          │       ├── spec.md         # 需求和场景
          │       └── design.md       # 技术设计
          ├── changes/                # 提案 - 具体变更的内容
          │   ├── [change-name]/
          │   │   ├── proposal.md     # 原因、内容、影响
          │   │   ├── tasks.md        # 实施清单
          │   │   ├── design.md       # 技术决策（可选；参见标准）
          │   │   └── specs/          # 增量变更
          │   │       └── [capability]/
          │   │           └── spec.md # ADDED/MODIFIED/REMOVED
          │   └── archive/            # 已完成的变更
          ```

          ## 创建变更提案

          ### 决策树

          ```
          新请求？
          ├─ 恢复规范行为的错误修复？→ 直接修复
          ├─ 拼写错误/格式/注释？→ 直接修复
          ├─ 新功能/能力？→ 创建提案
          ├─ 破坏性变更？→ 创建提案
          ├─ 架构变更？→ 创建提案
          └─ 不明确？→ 创建提案（更安全）
          ```

          ### 提案结构

          1. **创建目录：** `changes/[change-id]/`（短横线命名法，动词引导，唯一）

          2. **编写 proposal.md:**
          ```markdown
          # 变更：[变更的简要描述]

          ## 原因
          [关于问题/机会的 1-2 句话]

          ## 变更内容
          - [变更的要点列表]
          - [用 **BREAKING** 标记破坏性变更]

          ## 影响
          - 受影响的规范：[列出功能]
          - 受影响的代码：[关键文件/系统]
          例如：
          - **受影响的规范**：招聘管理 (Recruitment Management)
          - **受影响的代码**：
              - `hrms/static/api/menus.json`: 新增菜单项。
              - `hrms/views/`: 新增页面文件。
              - `hrms/service/candidate.go#L10-L20` & `hrms/handler/candidate.go#L10`: 新增或更新查询逻辑。
          ```

          3. **创建规范增量：** `specs/[capability]/spec.md`
          ```markdown
          ## ADDED Requirements
          ### Requirement: 新功能
          系统应提供...

          #### Scenario: 成功案例
          - **WHEN** 用户执行操作
          - **THEN** 预期结果

          ## MODIFIED Requirements
          ### Requirement: 现有功能
          [完整的修改后的需求]

          ## REMOVED Requirements
          ### Requirement: 旧功能
          **原因**：[为什么移除]
          **迁移**：[如何处理]
          ```
          如果多个功能受到影响，请在 `changes/[change-id]/specs/<capability>/spec.md` 下创建多个增量文件——每个功能一个。

          4. **创建 tasks.md:**
          ```markdown
          ## 1. 实施
          - [ ] 1.1 后端：在 `service/candidate.go#L10-L20` 中实现联合查询逻辑，支持按候选人姓名 (`name`) 和面试官姓名 (`staff_name`) 筛选。需处理 `Candidate` 表与 `Staff` 表的关联。
          - [ ] 1.2 前端：更新 `views/interview_record_manage.html#L10-L20` 中的 JS 逻辑，适配新的搜索 API 和评价更新 API。
          - [ ] 1.3 配置：更新 `hrms/static/api/menus.json#L10`，在“招聘管理”下添加“面试记录”菜单项。
          ```

          5. **在需要时创建 design.md:**
          如果满足以下任何条件，请创建 `design.md`；否则省略它：
          - 变更（多个服务/模块）或新架构模式
          - 新的外部依赖或重要的数据模型变更
          - 安全性、性能或任务复杂性较高

          最小的 `design.md` 框架：
          ```markdown
          ## 上下文
          [背景、约束、利益相关者]

          ## 目标 / 非目标
          - 目标：[...]
          - 非目标：[...]

          ## 决策
          - 决策：[内容和原因]
          - 考虑的替代方案：[选项 + 理由]

          ## 风险 / 权衡
          - [风险] → 缓解措施

          ## 迁移计划
          [步骤、回滚]

          ## 开放问题
          - [...]
          ```

          ## 规范文件格式

          ### 关键：场景格式

          **正确**（使用 #### 标题）：
          ```markdown
          #### Scenario: 用户登录成功
          - **WHEN** 提供有效凭据
          - **THEN** 返回 JWT 令牌
          ```

          **错误**（不要使用项目符号或粗体）：
          ```markdown
          - **Scenario: 用户登录**  ❌
          **Scenario**: 用户登录     ❌
          ### Scenario: 用户登录      ❌
          ```

          每个需求必须至少有一个场景。

          ### 需求措辞
          - 对规范性要求使用 SHALL/MUST（除非有意非规范性，否则避免使用 should/may）

          ### 增量操作

          - `## ADDED Requirements` - 新功能
          - `## MODIFIED Requirements` - 变更的行为
          - `## REMOVED Requirements` - 弃用的功能
          - `## RENAMED Requirements` - 名称变更

          标题使用 `trim(header)` 匹配 - 忽略空白字符。

          #### 何时使用 ADDED vs MODIFIED
          - ADDED：引入可以独立作为需求的新功能或子功能。当变更正交（例如添加"斜杠命令配置"）而不是改变现有需求的语义时，优先使用 ADDED。
          - MODIFIED：更改现有需求的行为、范围或验收标准。始终粘贴完整的更新需求内容（标题 + 所有场景）。归档器将用您在此处提供的内容替换整个需求；部分增量将丢失之前的详细信息。
          - RENAMED：仅在名称更改时使用。如果您还更改行为，请使用 RENAMED（名称）加上 MODIFIED（内容）引用新名称。

          常见陷阱：使用 MODIFIED 添加新关注点而不包含之前的文本。这会导致在归档时丢失详细信息。如果您没有明确更改现有需求，请在 ADDED 下添加新需求。

          正确编写 MODIFIED 需求：
          1) 在 `vibeplus/specs/<capability>/spec.md` 中找到现有需求。
          2) 复制整个需求块（从 `### Requirement: ...` 到其场景）。
          3) 将其粘贴到 `## MODIFIED Requirements` 下并编辑以反映新行为。
          4) 确保标题文本完全匹配（不区分空白字符）并至少保留一个 `#### Scenario:`。

          RENAMED 示例：
          ```markdown
          ## RENAMED Requirements
          - FROM: `### Requirement: 登录`
          - TO: `### Requirement: 用户认证`
          ```

          ## 故障排除

          ### 常见错误

          **"变更必须至少有一个增量"**
          - 检查 `changes/[name]/specs/` 存在且包含 .md 文件
          - 验证文件具有操作前缀（## ADDED Requirements）

          **"需求必须至少有一个场景"**
          - 检查场景使用 `#### Scenario:` 格式（4 个井号）
          - 不要对场景标题使用项目符号或粗体

          **静默场景解析失败**
          - 需要精确格式：`#### Scenario: 名称`

          ## 快速路径脚本

          ```bash
          # 1) 选择变更 id 并构建脚手架
          CHANGE=add-two-factor-auth
          mkdir -p vibeplus/changes/$CHANGE/{specs/auth}
          printf "## 原因\n...\n\n## 变更内容\n- ...\n\n## 影响\n- ...\n" > vibeplus/changes/$CHANGE/proposal.md
          printf "## 1. 实施\n- [ ] 1.1 ...\n" > vibeplus/changes/$CHANGE/tasks.md

          # 2) 添加增量（示例）
          cat > vibeplus/changes/$CHANGE/specs/auth/spec.md << 'EOF'
          ## ADDED Requirements
          ### Requirement: 双因素认证
          用户在登录期间必须提供第二个因素。

          #### Scenario: 需要一次性密码
          - **WHEN** 提供有效凭据
          - **THEN** 需要一次性密码挑战
          EOF
          ```

          ## 多功能示例

          ```
          vibeplus/changes/add-2fa-notify/
          ├── proposal.md
          ├── tasks.md
          └── specs/
              ├── auth/
              │   └── spec.md   # ADDED: 双因素认证
              └── notifications/
                  └── spec.md   # ADDED: 一次性密码邮件通知
          ```

          auth/spec.md
          ```markdown
          ## ADDED Requirements
          ### Requirement: 双因素认证
          ...
          ```

          notifications/spec.md
          ```markdown
          ## ADDED Requirements
          ### Requirement: 一次性密码邮件通知
          ...
          ```

          ## 最佳实践

          ### 清晰引用
          - 使用 `file.ts:42` 格式表示代码位置
          - 引用规范为 `specs/auth/spec.md`
          - 链接相关变更和 PR

          ### 功能命名
          - 使用动词-名词：`user-auth`, `payment-capture`
          - 每个功能单一目的
          - 10 分钟可理解规则
          - 如果描述需要 "AND"，则拆分

          ### 变更 ID 命名
          - 使用短横线命名法，简短且描述性：`add-two-factor-auth`
          - 优先使用动词引导前缀：`add-`, `update-`, `remove-`, `refactor-`
          - 确保唯一性；如果已被占用，附加 `-2`, `-3` 等


          ## 错误恢复

          ### 变更冲突
          1. 检查是否有重叠的规范
          2. 与变更所有者协调
          3. 考虑合并提案

          ### 验证失败
          1. 验证规范文件格式
          2. 确保场景格式正确

          ### 缺少上下文
          1. 检查相关规范
          2. 查看最近的归档
          3. 询问澄清问题

          ## 快速参考

          ### 阶段指示器
          - `changes/` - 已提议，尚未构建
          - `specs/` - 已构建和部署
          - `archive/` - 已完成的变更

          ### 文件用途
          - `proposal.md` - 提案原因和具体内容
          - `tasks.md` - 实施步骤
          - `design.md` - 技术决策
          - `spec.md` - 需求和行为
          ~~~

          记住：规范是事实。变更是提案。保持它们同步。

    scene1: # Group name, used to distinguish different scenarios
      # Specify which agents are effective, the structure here can reuse DisabledModesChangeAgents
      # If not configured, all will be effective, be careful!
      valid_agents:
        strict: # Mode name
          - "requirements" # agent name
          - "architect"
        vibe:
          - "review"
          - "code"

      skip_key: "%skip_key%" # If content contains this flag, skip processing directly

      match_keys:
        key1: |
          "The content you want to replace key1"
        key2: |
          "The content you want to replace key2"

  AgentsMatch:
    - agent: "strict"
      key: "a strict strategic workflow controller"
    - agent: "requirements"
      key: "an experienced requirements analyst specializing"
    - agent: "code"
      key: "a highly skilled software engineer"
    - agent: "architect"
      key: "an experienced technical leader"
    - agent: "task"
      key: "a project manager specializing in task decomposition"
    - agent: "test"
      key: "a professional testing engineer"
    - agent: "testguide"
      key: "a senior architect and testing expert"
    - agent: "review"
      key: "a code review expert skilled at analyzing issues"

# Department configuration
DepartmentApiEndpoint: "http://localhost:1234/work_id?work_id="

# Models supported by function calling
LLM:
  # Endpoint: "https://zgsm.sangfor.com/chat-rag/api/v1/chat/completions"
  # Endpoint: "http://zgsm.sangfor.com/oneapi/v1/chat/completions"
  Endpoint: "http://127.0.0.1:30616/chat-rag/api/v1/chat/completions"

LLMTimeout:
  # 单次连续空闲阈值（毫秒），默认 30000ms
  IdleTimeoutMs: 30000
  # 总空闲预算（毫秒），跨重试/降级累计空闲时长上限，默认 30000ms
  TotalIdleTimeoutMs: 30000

Redis:
  Addr: "127.0.0.1:6379"

# Forward configuration
# 不做对请求不做任何处理，只做记录，可用来抓包
forward:
  # Enable forwarding interface
  enabled: true
  # Default target URL for forwarding (optional)
  # If not provided, target URL must be specified in query parameter
  # defaultTarget: "http://zgsm.sangfor.com/"

# Nacos configuration center settings
nacos:
  # Nacos server address
  serverAddr: "localhost"
  # Nacos server port
  serverPort: 58080
  # Nacos gRPC port
  grpcPort: 9848
  # Nacos namespace (leave empty for default namespace)
  namespace: "2b57fb1d-34f8-4267-b0e6-f77c647d805f"
  # Nacos group for configuration
  group: "CHAT_RAG"
  # Nacos username for authentication (optional)
  username: "nacos"
  # Nacos password for authentication (optional)
  password: "nacos"
  # Timeout in seconds for Nacos operations
  timeoutSec: 10
  # Log directory for Nacos client
  logDir: "logs/nacos"
  # Cache directory for Nacos client
  cacheDir: "logs/nacos/cache"
  # Data ID for rules configuration
  rulesDataId: "agent_rules"
  # Data ID for tools configuration
  toolsDataId: "tools_prompt"
  # Data ID for precise context configuration
  preciseContextDataId: "precise_context"
  # Data ID for router configuration
  routerDataId: "model_router"