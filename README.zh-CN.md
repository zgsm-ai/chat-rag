# Chat-RAG ğŸš€

<div align="center">

[![Goç‰ˆæœ¬](https://img.shields.io/badge/Go-1.24.2-blue.svg)](https://golang.org/doc/go1.24) [![è®¸å¯è¯](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE) [![Docker](https://img.shields.io/badge/docker-available-blue.svg)](Dockerfile) [![æ„å»ºçŠ¶æ€](https://img.shields.io/badge/build-passing-brightgreen.svg)](#)

[English](./README.md) | [ä¸­æ–‡](#chinese)

</div>

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

Chat-RAG æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€ä¼ä¸šçº§çš„èŠå¤©æœåŠ¡ï¼Œç»“åˆäº†å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä¸æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰åŠŸèƒ½ã€‚å®ƒä¸ºç°ä»£ AI åº”ç”¨æä¾›æ™ºèƒ½ä¸Šä¸‹æ–‡å¤„ç†ã€å·¥å…·é›†æˆå’Œæµå¼å“åº”åŠŸèƒ½ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **ğŸ§  æ™ºèƒ½ä¸Šä¸‹æ–‡å¤„ç†**ï¼šå…ˆè¿›çš„æç¤ºå·¥ç¨‹ï¼Œæ”¯æŒä¸Šä¸‹æ–‡å‹ç¼©å’Œè¿‡æ»¤
- **ğŸ”§ å·¥å…·é›†æˆ**ï¼šæ— ç¼é›†æˆè¯­ä¹‰æœç´¢ã€ä»£ç å®šä¹‰æŸ¥è¯¢å’ŒçŸ¥è¯†åº“æŸ¥è¯¢
- **âš¡ æµå¼æ”¯æŒ**ï¼šé€šè¿‡æœåŠ¡å™¨å‘é€äº‹ä»¶ï¼ˆSSEï¼‰å®ç°å®æ—¶æµå¼å“åº”
- **ğŸ›¡ï¸ ä¼ä¸šå®‰å…¨**ï¼šåŸºäº JWT çš„èº«ä»½éªŒè¯å’Œè¯·æ±‚éªŒè¯
- **ğŸ“Š å…¨é¢ç›‘æ§**ï¼šå†…ç½®æŒ‡æ ‡å’Œæ—¥å¿—è®°å½•ï¼Œæ”¯æŒ Prometheus
- **ğŸ”„ å¤šæ¨¡æ€æ”¯æŒ**ï¼šæ”¯æŒå„ç§ LLM æ¨¡å‹å’Œå‡½æ•°è°ƒç”¨
- **ğŸš€ é«˜æ€§èƒ½**ï¼šä¼˜åŒ–çš„ä½å»¶è¿Ÿå“åº”å’Œé«˜ååé‡

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API ç½‘å…³      â”‚â”€â”€â”€â–¶â”‚  èŠå¤©å¤„ç†å™¨     â”‚â”€â”€â”€â–¶â”‚  æç¤ºå¼•æ“       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   èº«ä»½éªŒè¯      â”‚    â”‚  LLM å®¢æˆ·ç«¯     â”‚    â”‚  å·¥å…·æ‰§è¡Œå™¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æŒ‡æ ‡ç›‘æ§      â”‚    â”‚  Redis ç¼“å­˜     â”‚    â”‚  æœç´¢å·¥å…·       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Go 1.24.2 æˆ–æ›´é«˜ç‰ˆæœ¬
- Redis 6.0+ï¼ˆå¯é€‰ï¼Œç”¨äºç¼“å­˜ï¼‰
- Dockerï¼ˆå¯é€‰ï¼Œç”¨äºå®¹å™¨åŒ–éƒ¨ç½²ï¼‰

### å®‰è£…æ­¥éª¤

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/zgsm-ai/chat-rag.git
cd chat-rag

# å®‰è£…ä¾èµ–
make deps

# æ„å»ºåº”ç”¨
make build

# ä½¿ç”¨é»˜è®¤é…ç½®è¿è¡Œ
make run
```

### Docker éƒ¨ç½²

```bash
# æ„å»º Docker é•œåƒ
make docker-build

# è¿è¡Œå®¹å™¨
make docker-run
```

## âš™ï¸ é…ç½®è¯´æ˜

æœåŠ¡é€šè¿‡ YAML æ–‡ä»¶è¿›è¡Œé…ç½®ã€‚æŸ¥çœ‹ [`etc/chat-api.yaml`](etc/chat-api.yaml) äº†è§£é»˜è®¤é…ç½®ï¼š

```yaml
Name: chat-rag
Host: 0.0.0.0
Port: 8888

# LLM é…ç½®
LLM:
  Endpoint: "http://127.0.0.1:30616/v1/chat/completions"
  FuncCallingModels: ["gpt-4", "claude-3"]

# Redis é…ç½®
Redis:
  Addr: "127.0.0.1:6379"
  Password: ""
  DB: 0

# å·¥å…·é…ç½®
Tools:
  SemanticSearch:
    SearchEndpoint: "http://localhost:9001/api/v1/search/semantic"
    TopK: 50
    ScoreThreshold: 0.7
```

## ğŸ“¡ API ç«¯ç‚¹

### èŠå¤©å®Œæˆ

```http
POST /chat-rag/api/v1/chat/completions
Content-Type: application/json
Authorization: Bearer <token>

{
  "model": "gpt-4",
  "messages": [
    {
      "role": "user",
      "content": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
    }
  ],
  "stream": true,
  "extra_body": {
    "prompt_mode": "rag_compress"
  }
}
```

### è¯·æ±‚çŠ¶æ€

```http
GET /chat-rag/api/v1/chat/requests/{requestId}/status
```

### æŒ‡æ ‡ç›‘æ§

```http
GET /metrics
```

## ğŸ”§ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
chat-rag/
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ handler/          # HTTP å¤„ç†å™¨
â”‚   â”œâ”€â”€ logic/           # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ client/          # å¤–éƒ¨æœåŠ¡å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ promptflow/      # æç¤ºå¤„ç†ç®¡é“
â”‚   â”œâ”€â”€ functions/       # å·¥å…·æ‰§è¡Œå¼•æ“
â”‚   â””â”€â”€ config/          # é…ç½®ç®¡ç†
â”œâ”€â”€ etc/                 # é…ç½®æ–‡ä»¶
â”œâ”€â”€ test/               # æµ‹è¯•æ–‡ä»¶
â””â”€â”€ deploy/             # éƒ¨ç½²é…ç½®
```

### å¯ç”¨å‘½ä»¤

```bash
make help              # æ˜¾ç¤ºå¯ç”¨å‘½ä»¤
make build            # æ„å»ºåº”ç”¨
make test             # è¿è¡Œæµ‹è¯•
make fmt              # æ ¼å¼åŒ–ä»£ç 
make vet              # æ£€æŸ¥ä»£ç 
make docker-build     # æ„å»º Docker é•œåƒ
make dev              # è¿è¡Œå¼€å‘æœåŠ¡å™¨ï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
```

### æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# è¿è¡Œç‰¹å®šæµ‹è¯•
go test -v ./internal/logic/

# å¸¦è¦†ç›–ç‡è¿è¡Œ
go test -cover ./...
```

## ğŸ” é«˜çº§åŠŸèƒ½

### ä¸Šä¸‹æ–‡å‹ç¼©

æ™ºèƒ½ä¸Šä¸‹æ–‡å‹ç¼©å¤„ç†é•¿å¯¹è¯ï¼š

```yaml
ContextCompressConfig:
  EnableCompress: true
  TokenThreshold: 100000
  SummaryModel: "qwen2.5-coder-32b"
  RecentUserMsgUsedNums: 3
```

### å·¥å…·é›†æˆ

æ”¯æŒå¤šç§æœç´¢å’Œåˆ†æå·¥å…·ï¼š

- **è¯­ä¹‰æœç´¢**ï¼šåŸºäºå‘é‡çš„ä»£ç å’Œæ–‡æ¡£æœç´¢
- **å®šä¹‰æœç´¢**ï¼šä»£ç å®šä¹‰æŸ¥è¯¢
- **å¼•ç”¨æœç´¢**ï¼šä»£ç å¼•ç”¨åˆ†æ
- **çŸ¥è¯†æœç´¢**ï¼šæ–‡æ¡£çŸ¥è¯†åº“æŸ¥è¯¢

### åŸºäºä»£ç†çš„å¤„ç†

å¯é…ç½®çš„ä»£ç†åŒ¹é…ï¼Œç”¨äºä¸“é—¨ä»»åŠ¡ï¼š

```yaml
AgentsMatch:
  - AgentName: "strict"
    MatchKey: "a strict strategic workflow controller"
  - AgentName: "code"
    MatchKey: "a highly skilled software engineer"
```

## ğŸ“Š ç›‘æ§å’Œå¯è§‚æµ‹æ€§

### æŒ‡æ ‡ç›‘æ§

æœåŠ¡åœ¨ `/metrics` ç«¯ç‚¹æš´éœ² Prometheus æŒ‡æ ‡ï¼š

- è¯·æ±‚è®¡æ•°å’Œå»¶è¿Ÿ
- Token ä½¿ç”¨ç»Ÿè®¡
- å·¥å…·æ‰§è¡ŒæŒ‡æ ‡
- é”™è¯¯ç‡å’Œç±»å‹

### æ—¥å¿—è®°å½•

ä½¿ç”¨ Zap è®°å½•å™¨è¿›è¡Œç»“æ„åŒ–æ—¥å¿—è®°å½•ï¼š

- è¯·æ±‚/å“åº”æ—¥å¿—è®°å½•
- é”™è¯¯è·Ÿè¸ª
- æ€§èƒ½æŒ‡æ ‡
- è°ƒè¯•ä¿¡æ¯

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- åŸºäº JWT çš„èº«ä»½éªŒè¯
- è¯·æ±‚éªŒè¯å’Œæ¸…ç†
- é€Ÿç‡é™åˆ¶æ”¯æŒ
- å®‰å…¨å¤´éƒ¨å¤„ç†

## ğŸš¢ éƒ¨ç½²æ–¹æ¡ˆ

### ç”Ÿäº§éƒ¨ç½²

```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
CGO_ENABLED=0 GOOS=linux go build -o chat-rag .

# ä½¿ç”¨ç”Ÿäº§é…ç½®è¿è¡Œ
./chat-rag -f etc/prod.yaml
```

### Kubernetes éƒ¨ç½²

æŸ¥çœ‹ [`deploy/`](deploy/) ç›®å½•ä¸­çš„ Kubernetes æ¸…å•å’Œ Helm å›¾è¡¨ã€‚

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ï¼ˆ`git checkout -b feature/amazing-feature`ï¼‰
3. æäº¤æ›´æ”¹ï¼ˆ`git commit -m 'Add some amazing feature'`ï¼‰
4. æ¨é€åˆ°åˆ†æ”¯ï¼ˆ`git push origin feature/amazing-feature`ï¼‰
5. æ‰“å¼€æ‹‰å–è¯·æ±‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ†˜ æ”¯æŒ

å¦‚éœ€æ”¯æŒå’Œæé—®ï¼š
- åœ¨ GitHub ä»“åº“ä¸­åˆ›å»ºé—®é¢˜
- è”ç³»ç»´æŠ¤è€…

---

<div align="center">
  <b>â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªæ˜Ÿæ ‡ï¼</b>
</div>